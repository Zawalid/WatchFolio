"use strict";import"/watchList.min.js";import"/favoritesList.min.js";import{handleAccount as e,handleUserAuth as t}from"/utilities.min.js";import{auth as n,signInWithCredential as r,GoogleAuthProvider as a}from"/firebaseApp.min.js";const i={method:"GET",headers:{accept:"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI3OWUxNjZjMzNhZjE4ZmVlNTgzNWJiMDBiOGE5ZTA1NCIsInN1YiI6IjY0YTJiOTcxMTEzODZjMDBhZGM3OTQxMyIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.yxORg4upeOsiqCve7e9CDV4i-_Q2LfIpnqKKax3Fnw4"}},o=e=>`
  <a href="show.html?id=${e?.id}">
  <div class="w-[210px] h-[270px] peer group relative overflow-hidden max-md:w-[140px] max-md:h-[200px]">
    <img
      src="${e?.image?.medium||"imgs/placeholder.png"}"
      alt="${e?.name}"
      class="w-full h-full object-cover rounded-md shadow-shadow1 mb-2"
    />
    <div
      class="blur-[60px] top-0 absolute -z-10 flex h-full w-full flex-col gap-3 bg-dark p-3 transition-all duration-[.8s] group-hover:z-10 group-hover:bg-dark group-hover:bg-opacity-50 group-hover:blur-0"
    >
      <div
        class="w-fit rounded-lg bg-thirdAccent px-3 text-sm font-semibold text-textColor"
      >
        ${e?.genres[0]||"No genre"}
      </div>
      <div
        class="flex w-fit items-center gap-1 rounded-lg bg-secondaryAccent px-3 text-sm font-semibold text-textColor"

      >
        ${e?.rating.average||"Not rated"} <i class="fa-solid fa-star text-primaryAccent"></i>
      </div>
      <h3 class="mt-auto font-logo text-lg font-bold text-textColor">
        ${e?.name}
      </h3>
    </div>
  </div>
</a>
  `,s=document.getElementById("search_results"),l=document.getElementById("search_input"),c=document.getElementById("search_button"),d=`
<div class="flex flex-col items-center justify-center col-span-5 h-full">
<img src="imgs/wrong.svg" alt="" class="h-64 w-64" />
<h2 class="mb-3 text-xl font-bold text-thirdAccent">Something went wrong</h2>
<h3 class="font-semibold text-textColor2 text-center">
  Please try again later
</h3>
</div>
`,u=async e=>{try{s.innerHTML=`
    <i
    class="fa-solid fa-spinner absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 animate-spin text-4xl text-thirdAccent"
  ></i>
    `;var t=await(await fetch(" https://api.tvmaze.com/search/shows?q="+e)).json();if(0===t.length)s.innerHTML=`
  <div class="flex flex-col items-center justify-center col-span-5">
  <img src="imgs/no_result.png" alt="" class="h-64 " />
  <h2 class="mb-3 text-xl font-bold text-thirdAccent">No Results Found</h2>
  <h3 class="font-semibold text-textColor2 text-center">
    We couldn't find any show matching your search
  </h3>
</div>
  `;else{s.innerHTML="";for(const a of t){var n=a.show,r=o(n);s.innerHTML+=r}}}catch{s.innerHTML=d}},h=e=>{s.classList.replace("hidden","flex"),s.scrollIntoView({behavior:"smooth"}),u(l.value)},f=()=>{""===l.value&&(s.classList.replace("grid","hidden"),s.innerHTML="",l.blur())},m=([h,f].forEach(t=>{l.addEventListener("keyup",e=>{"Enter"===e.key&&t()}),c.addEventListener("click",t)}),document.querySelector("#explore #shows")),x=document.querySelectorAll("#exploreTabs button"),g=document.querySelector("#explore #pagination"),p=async(e,t=null)=>{try{m.innerHTML=`
    <i
    class="fa-solid fa-spinner absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 animate-spin text-4xl text-thirdAccent"
  ></i>
    `;var n=await(await fetch("https://api.themoviedb.org/3/"+e+(t?"?page="+t:""),i)).json(),r=await Promise.all(n.results.map(async e=>{try{var t=await(await fetch("https://api.tvmaze.com/singlesearch/shows?q="+e.name)).json();if(t?.name&&!t.genres.includes("Anime"))return o(t)}catch{}}));m.innerHTML=r.join("")}catch{m.innerHTML=d}},v=(p("trending/tv/day"),x.forEach(e=>{e.addEventListener("click",function(){x.forEach(e=>e.classList.remove("active")),this.classList.add("active");var e=this.dataset.url;"trending"===this.dataset.name?g.classList.replace("flex","hidden"):(g.classList.replace("hidden","flex"),g.querySelectorAll("#numbers button").forEach((e,t)=>e.innerText=t+1),y(g.querySelectorAll("#numbers button")[0]),b=1,w(1,[v[0],v[1]])),p(e)})}),document.querySelectorAll("#pagination button"));let b=+g.dataset.current_page;const y=e=>{g.querySelectorAll("#numbers button").forEach(e=>e.classList.remove("active")),e.classList.add("active")},w=(e,t)=>{b===e?t.forEach(e=>e.style.opacity=".5"):t.forEach(e=>e.style.opacity="1")};function T(){google.accounts.id.initialize({client_id:"338374125620-cd7p79tha3ehscal53eonfjt8n2m5gud.apps.googleusercontent.com",callback:L}),google.accounts.id.prompt()}function L(e){e.credential&&(e=e.credential,r(n,a.credential(e)))}w(1,[v[0],v[1]]),g.addEventListener("click",async function(e){if(e.target.closest("button")){var e=e.target.closest("button"),t=document.querySelector("#exploreTabs .active").dataset.url,n=[...g.querySelectorAll("#numbers button")],r=await(await fetch("https://api.themoviedb.org/3/"+t,i)).json();const a=500<r.total_pages?500:r.total_pages;if("first"===e.id){if(1===b)return;b=1,n.forEach((e,t)=>e.innerText=t+1)}else if("last"===e.id){if(b===a)return;b=a,n.forEach((e,t,n)=>n.toReversed()[t].innerText=a-t)}else if("prev"===e.id){if(1===b)return;b--,n.find(e=>1==+e.innerText)||n.forEach(e=>e.innerText--)}else if("next"===e.id){if(b===a)return;b++,n.find(e=>+e.innerText===a)||n.forEach(e=>e.innerText++)}else b=+e.innerText,1!=+e.innerText&&+e.innerText!==a&&(2<(r=n.indexOf(e))&&!n.find(e=>+e.innerText===a)?(n[0].remove(),document.getElementById("numbers").insertAdjacentHTML("beforeend",`
        <button
        class="h-10 w-10 rounded-full bg-dark text-center font-bold text-textColor transition-colors duration-300 hover:bg-secondaryAccent"
      >
        ${+n[4].innerText+1}
      </button>
        `)):r<2&&!n.find(e=>1==+e.innerText)&&(n[4].remove(),document.getElementById("numbers").insertAdjacentHTML("afterbegin",`
        <button
        class="h-10 w-10 rounded-full bg-dark text-center font-bold text-textColor transition-colors duration-300 hover:bg-secondaryAccent"
      >
        ${+n[0].innerText-1}
      </button>
        `)));w(1,[v[0],v[1]]),w(a,[v[7],v[8]]),y(n.find(e=>+e.innerText===b)),p(t,b)}}),"serviceWorker"in navigator&&navigator.serviceWorker.register("./service-worker.js").then(e=>{}).catch(e=>{console.log("Service Worker Failed to Register",e)}),t(),window.onload=function(){T()},e();document.getElementById("nav").querySelectorAll("li")[1].addEventListener("click",()=>{document.querySelector(".show")?.classList.remove("show"),document.body.classList.remove("overflow-hidden")});