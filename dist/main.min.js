"use strict";import"/watchList.min.js";import"/favoritesList.min.js";import{checkIfUserIsLoggedIn as e,handleAccount as t,handleUserAuth as n}from"/utilities.min.js";import{auth as r,signInWithCredential as s,GoogleAuthProvider as a}from"/firebaseApp.min.js";const o={method:"GET",headers:{accept:"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI3OWUxNjZjMzNhZjE4ZmVlNTgzNWJiMDBiOGE5ZTA1NCIsInN1YiI6IjY0YTJiOTcxMTEzODZjMDBhZGM3OTQxMyIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.yxORg4upeOsiqCve7e9CDV4i-_Q2LfIpnqKKax3Fnw4"}},i=e=>`
  <a href="show?id=${e?.id}">
  <div class="w-[210px] h-[270px] peer group relative overflow-hidden max-md:w-[140px] max-md:h-[200px]">
    <img
      src="${e?.image?.medium||"imgs/placeholder.png"}"
      alt="${e?.name}"
      class="w-full h-full object-cover rounded-md shadow-shadow1 mb-2"
    />
    <div
      class="blur-[60px] top-0 absolute -z-10 flex h-full w-full flex-col gap-3 bg-dark p-3 transition-all duration-[.8s] group-hover:z-10 group-hover:bg-dark group-hover:bg-opacity-50 group-hover:blur-0"
    >
      <div
        class="w-fit rounded-lg bg-thirdAccent px-3 text-sm font-semibold text-textColor"
      >
        ${e?.genres[0]||"No genre"}
      </div>
      <div
        class="flex w-fit items-center gap-1 rounded-lg bg-secondaryAccent px-3 text-sm font-semibold text-textColor"

      >
        ${e?.rating.average||"Not rated"} <i class="fa-solid fa-star text-primaryAccent"></i>
      </div>
      <h3 class="mt-auto font-logo text-lg font-bold text-textColor">
        ${e?.name}
      </h3>
    </div>
  </div>
</a>
  `,l=document.getElementById("search_results"),c=document.getElementById("search_input"),d=document.getElementById("search_button"),h=`
<div class="flex flex-col items-center justify-center col-span-5 h-full">
<img src="imgs/wrong.svg" alt="" class="h-64 w-64" />
<h2 class="mb-3 text-xl font-bold text-thirdAccent">Something went wrong</h2>
<h3 class="font-semibold text-textColor2 text-center">
  Please try again later
</h3>
</div>
`,u=async e=>{try{l.innerHTML=`
    <i
    class="fa-solid fa-spinner absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 animate-spin text-4xl text-thirdAccent"
  ></i>
    `;var t=await(await fetch(" https://api.tvmaze.com/search/shows?q="+e)).json();if(0===t.length)l.innerHTML=`
  <div class="flex flex-col items-center justify-center col-span-5">
  <img src="imgs/no_result.png" alt="" class="h-64 " />
  <h2 class="mb-3 text-xl font-bold text-thirdAccent">No Results Found</h2>
  <h3 class="font-semibold text-textColor2 text-center">
    We couldn't find any show matching your search
  </h3>
</div>
  `;else{l.innerHTML="";for(const s of t){var n=s.show,r=i(n);l.innerHTML+=r}}}catch{l.innerHTML=h}},f=e=>{l.classList.replace("hidden","flex"),l.scrollIntoView({behavior:"smooth"}),u(c.value)},m=()=>{""===c.value&&(l.classList.replace("grid","hidden"),l.innerHTML="",c.blur())},x=([f,m].forEach(t=>{c.addEventListener("keyup",e=>{"Enter"===e.key&&t()}),d.addEventListener("click",t)}),document.querySelector("#explore #shows")),g=document.querySelectorAll("#exploreTabs button"),p=document.querySelector("#explore #pagination"),v=async(e,t=null)=>{try{x.innerHTML=`
    <i
    class="fa-solid fa-spinner absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 animate-spin text-4xl text-thirdAccent"
  ></i>
    `;var n=await(await fetch("https://api.themoviedb.org/3/"+e+(t?"?page="+t:""),o)).json(),r=await Promise.all(n.results.map(async e=>{try{var t=await(await fetch("https://api.tvmaze.com/singlesearch/shows?q="+e.name)).json();if(t?.name&&!t.genres.includes("Anime"))return i(t)}catch{}}));x.innerHTML=r.join("")}catch{x.innerHTML=h}},b=(v("trending/tv/day"),g.forEach(e=>{e.addEventListener("click",function(){g.forEach(e=>e.classList.remove("active")),this.classList.add("active");var e=this.dataset.url;"trending"===this.dataset.name?p.classList.replace("flex","hidden"):(p.classList.replace("hidden","flex"),p.querySelectorAll("#numbers button").forEach((e,t)=>e.innerText=t+1),w(p.querySelectorAll("#numbers button")[0]),y=1,T(1,[b[0],b[1]])),v(e)})}),document.querySelectorAll("#pagination button"));let y=+p.dataset.current_page;const w=e=>{p.querySelectorAll("#numbers button").forEach(e=>e.classList.remove("active")),e.classList.add("active")},T=(e,t)=>{y===e?t.forEach(e=>e.style.opacity=".5"):t.forEach(e=>e.style.opacity="1")};T(1,[b[0],b[1]]),p.addEventListener("click",async function(e){if(e.target.closest("button")){var e=e.target.closest("button"),t=document.querySelector("#exploreTabs .active").dataset.url,n=[...p.querySelectorAll("#numbers button")],r=await(await fetch("https://api.themoviedb.org/3/"+t,o)).json();const s=500<r.total_pages?500:r.total_pages;if("first"===e.id){if(1===y)return;y=1,n.forEach((e,t)=>e.innerText=t+1)}else if("last"===e.id){if(y===s)return;y=s,n.forEach((e,t,n)=>n.toReversed()[t].innerText=s-t)}else if("prev"===e.id){if(1===y)return;y--,n.find(e=>1==+e.innerText)||n.forEach(e=>e.innerText--)}else if("next"===e.id){if(y===s)return;y++,n.find(e=>+e.innerText===s)||n.forEach(e=>e.innerText++)}else y=+e.innerText,1!=+e.innerText&&+e.innerText!==s&&(2<(r=n.indexOf(e))&&!n.find(e=>+e.innerText===s)?(n[0].remove(),document.getElementById("numbers").insertAdjacentHTML("beforeend",`
        <button
        class="h-10 w-10 rounded-full bg-dark text-center font-bold text-textColor transition-colors duration-300 hover:bg-secondaryAccent"
      >
        ${+n[4].innerText+1}
      </button>
        `)):r<2&&!n.find(e=>1==+e.innerText)&&(n[4].remove(),document.getElementById("numbers").insertAdjacentHTML("afterbegin",`
        <button
        class="h-10 w-10 rounded-full bg-dark text-center font-bold text-textColor transition-colors duration-300 hover:bg-secondaryAccent"
      >
        ${+n[0].innerText-1}
      </button>
        `)));T(1,[b[0],b[1]]),T(s,[b[7],b[8]]),w(n.find(e=>+e.innerText===y)),v(t,y)}}),"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js").then(e=>{}).catch(e=>{console.log("Service Worker Failed to Register",e)}),n(),t(),document.getElementById("nav").querySelectorAll("li")[1].addEventListener("click",()=>{document.querySelector(".show")?.classList.remove("show"),document.body.classList.remove("overflow-hidden")});