import{auth as h,onAuthStateChanged as e,sendEmailVerification as g,sendPasswordResetEmail as w,signOut as a,updateProfile as f,updateEmail as p,updatePassword as v,getStorage as y,ref as L,uploadString as E,getDownloadURL as x,reauthenticateWithCredential as S,EmailAuthProvider as b,getSignInErrorMessage as I,db as k,doc as q,getDoc as r,updateDoc as n,setDoc as i,deleteDoc as A,deleteObject as B}from"/firebaseApp.min.js";const _=()=>{document.querySelectorAll(".password_input").forEach(t=>{const s=t.nextElementSibling;document.addEventListener("click",e=>{"show_password"===e.target.id&&("password"==t.type&&""!=t.value?(t.type="text",s.className="fa-solid fa-eye-slash absolute z-30 right-3 top-1/2 cursor-pointer text-sm text-textColor2"):(t.type="password",s.className="fa-solid fa-eye absolute z-30 right-3 top-1/2 cursor-pointer text-sm text-textColor2")),t?.contains(e.target)||s?.contains(e.target)||"text"!=t?.type||(t.type="password",s.className="fa-solid fa-eye absolute z-30 right-3 top-1/2 cursor-pointer text-sm text-textColor2")})})},C=()=>{var e=document.querySelector("[name='password']");const t=document.getElementById("chars_long_validation"),s=document.getElementById("special_chars_validation"),a=document.getElementById("numbers_validation"),o=document.getElementById("uppercase_validation"),r=document.getElementById("lowercase_validation"),n="fa-regular fa-check-circle text-red-300 mr-3";return e.addEventListener("input",function(){function e(e,t){t.className=e?"fa-solid fa-check-circle text-green-500  mr-3":n}e(8<=this.value.length,t),e(this.value.match(/[^a-zA-Z0-9]/g),s),e(this.value.match(/[0-9]/g),a),e(this.value.match(/[A-Z]/g),o),e(this.value.match(/[a-z]/g),r)}),t.className!==n&&s.className!==n&&a.className!==n&&o.className!==n&&r.className!==n},P=(e,t)=>{const s=document.getElementById("message");"error"===t?s.classList.replace("bg-thirdAccent","bg-red-700"):s.classList.replace("bg-red-700","bg-thirdAccent"),s.textContent=e,s.classList.replace("-top-1/2","top-5"),setTimeout(()=>{s.classList.replace("top-5","-top-1/2")},4e3)},t=()=>{const e=document.getElementById("connectionStatus"),t=()=>{e.classList.replace("-bottom-14","bottom-3"),setTimeout(()=>{e.classList.replace("bottom-3","-bottom-14")},3e3)};window.addEventListener("online",()=>{e.lastElementChild.innerText="Back online",e.classList.replace("text-textColor2","text-primaryAccent"),t()}),window.addEventListener("offline",()=>{e.lastElementChild.innerText="You are offline",e.classList.replace("text-primaryAccent","text-textColor2"),t()})},s=(t(),(e,t,s,a)=>{document.querySelectorAll("#"+e).forEach(e=>{e.addEventListener("click",function(){"watchList"===t.id?a("watched"):a("shows"),t.classList.toggle("show"),this.classList.add("active"),!t.classList.contains("show")&&window.location.pathname.includes("show.html")?document.body.classList.remove("h-screen","overflow-hidden"):document.body.classList.remove("overflow-hidden"),window.matchMedia("(max-width: 768px)").matches?(document.getElementById("nav").appendChild(s),s.classList.toggle("hidden")):(t.appendChild(s),s.classList.remove("hidden")),window.matchMedia("(max-width: 768px)").matches&&(window.scrollTo(0,0),t.classList.contains("show"))&&document.body.classList.add("h-screen","overflow-hidden")})})}),o=(t,s,a,o)=>{document.addEventListener("click",e=>{s.contains(e.target)||e.target.closest("#"+t)||e.target.closest("#downloadList")||a.contains(e.target)||(s.classList.remove("show"),a.classList.add("hidden"),document.querySelectorAll("#"+t).forEach(e=>{e.classList.remove("active")}),"watchList"===s.id?o("watched"):o("shows"))})},c=async(e,t)=>{e=await(await fetch("https://api.tvmaze.com/shows/"+e)).json();return`
  <div class="flex items-center justify-between" >
<a href="show.html?id=${e.id}" class="flex items-center gap-3 " data-id="${e.id}" >
<img src="${e.image?.medium||"imgs/placeholder.png"}" alt="" class="w-[100px] rounded-lg" >
<h3 class="text-textColor font-bold text-lg">${e.name} </h3>
</a>
<i class="fa-solid fa-trash text-textColor2 transition-colors hover:text-secondaryAccent duration-300 text-lg cursor-pointer" id="${"favoritesList"===t.id?"removeFromFavoriteList":"removeFromWatchList"}"></i>
</div>
`},l=(t,s,a,o)=>{t.forEach(e=>{e.addEventListener("click",function(){t.forEach(e=>e.classList.remove("active")),this.classList.add("active"),s.dataset["current_"+a]=this.dataset[a],o(this.dataset[a])})})},d=(s,a,o,r,n,i)=>{document.addEventListener("click",e=>{if(e.target.closest("#"+s)){e=e.target.closest("#"+s).previousElementSibling.dataset.id;const t=a.dataset["current_"+o];window.location.href.includes("show.html?id="+e)&&document.querySelectorAll(`#overview button[data-${o}]`).forEach(e=>{e.dataset[o]==t&&(e.innerHTML=r[t].defaultButton||r.defaultButton)}),i(e,r[t]),n(t)}})},u=(a,o,r,n)=>{const i=a.querySelector("#clear_confirmation");a.querySelector("#actions #clear").addEventListener("click",()=>{const s="watchList"===a.id?"shows":"list";0<o[a.dataset["current_"+r]][s].size&&i.classList.replace("hidden","flex"),i.addEventListener("click",e=>{if(e.target.closest("#no")&&i.classList.replace("flex","hidden"),e.target.closest("#yes")){i.classList.replace("flex","hidden");const t=a.dataset["current_"+r];window.localStorage.setItem(t,""),o[t][s].clear(),n(t),window.location.pathname.includes("show.html")&&document.querySelectorAll("#overview button").forEach(e=>{e.dataset[r]==t&&(e.innerHTML=o[t].defaultButton||o.defaultButton)})}})})},m=o=>{const e=e=>{const t=[...o.querySelectorAll("[data-id]")];let s=[],a;a="AZ"===e?t.map(e=>e.querySelector("h3").textContent).toSorted():t.map(e=>e.querySelector("h3").textContent).toSorted().toReversed(),t.forEach(e=>{s.push(t.find(e=>e.querySelector("h3").textContent==a[0]).parentElement),a.shift()});e=s.map(e=>e.outerHTML).join("");0<s.length&&(o.querySelector("#"+("watchList"===o.id?"shows":"favorites")).innerHTML=e)};o.querySelector("#actions #sortAZ").addEventListener("click",()=>e("AZ")),o.querySelector("#actions #sortZA").addEventListener("click",()=>e("ZA"))},U=(e,t,s)=>{const a=e.value.toLowerCase();e=s.filter(e=>e.querySelector("h3").textContent.toLowerCase().includes(a));t.querySelector("#"+("watchList"===t.id?"shows":"favorites")).innerHTML=0<e.length?e.map(e=>e.parentElement.outerHTML).join(""):`<div class="flex flex-col flex-1 items-center justify-center col-span-5 ml-[50%] -translate-x-1/2">
      <img src="imgs/no_result.png" alt="" class="w-52" />
      <h2 class="text-xl font-bold text-textColor2">No Results Found</h2>
      </div>
      `},T=(e,t,s,a)=>{0<s[e.dataset["current_"+a]]["watchList"===e.id?"shows":"list"].size&&t.classList.toggle("show"),t.classList.contains("show")?t.focus():t.blur(),t.classList.contains("show")?document.querySelector("#actions #search").classList.replace("fa-magnifying-glass-plus","fa-magnifying-glass-minus"):document.querySelector("#actions #search").classList.replace("fa-magnifying-glass-minus","fa-magnifying-glass-plus")},M=(e,t)=>{t.value="",t.classList.remove("show"),document.querySelector("#actions #search").classList.replace("fa-magnifying-glass-minus","fa-magnifying-glass-plus")},F=async(t,s)=>{const a="Favorites"===t?"list":"watchList"===t?"shows":"episodes";try{const o=await N();s.forEach(e=>{n(q(k,t,o.uid),{[e.name]:[...e[a]]})})}catch(e){s.forEach(e=>{window.localStorage.setItem(e.name,[...e[a]])})}},R=async(t,s)=>{const a="Favorites"===t?"list":"watchList"===t?"shows":"episodes";try{var e=await N();return r(q(k,t,e.uid)).then(e=>(e.exists()&&(s[a]=new Set(e.data()[s.name])),Promise.resolve(s)))}catch(e){t=window.localStorage.getItem(s.name)?.split(",");return t&&""==t[0]&&t.splice(0,1),s[a]=new Set(t),Promise.resolve(s)}},z=async(s,a)=>{try{const o=await N();for(let t of a)r(q(k,s,o.uid)).then(e=>{e.exists()?e.data()[t]||n(q(k,s,o.uid),{[t]:[]}):i(q(k,s,o.uid),{[t]:[]})})}catch(e){a.forEach(e=>{window.localStorage.getItem(e)||window.localStorage.setItem(e,"")})}},N=()=>new Promise((t,s)=>{e(h,e=>{e?t(e):s("User is not logged in")})}),D=async t=>{var e=await(await fetch(`https://ui-avatars.com/api/?name=${t.displayName}&background=D4D4D4&rounded=true&size=128&bold=true&color=130F40`)).blob();const s=URL.createObjectURL(e);document.getElementById("username").innerText=t.displayName,document.getElementById("accountDetails_form").firstName.value=t.displayName.split(" ")[0],document.getElementById("accountDetails_form").lastName.value=t.displayName.split(" ")[1],document.getElementById("email").innerText=document.getElementById("accountDetails_form").email.value=t.email,document.querySelectorAll(".avatar").forEach(e=>e.src=t.photoURL||s);try{(await fetch(t.photoURL,{mode:"no-cors"})).ok||document.querySelectorAll(".avatar").forEach(e=>e.src=s)}catch(e){}},O=async()=>{var t=document.getElementById("sign");const s=document.getElementById("signOut_confirmation");try{var e=await N();if(!e.emailVerified&&("/"===window.location.pathname||"/index.html"===window.location.pathname)){if(document.cookie.includes("emailSent=true"))return;g(e).then(()=>{P("A verification email has been sent to your email address. Please check your inbox and click the verification link to verify your email.","info"),document.cookie="emailSent=true; max-age=86400; path=/"})}D(e),t.innerHTML=`
    <i class="fa-solid fa-sign-out text-2xl"></i>
    <span class="font-semibold">Sign Out</span>
    `,t.dataset.sign="out",window.localStorage.clear()}catch(e){t.innerHTML=`
   <i class="fa-solid fa-sign-in text-2xl"></i>
   <span class="font-semibold">Sign In</span>
   `,t.dataset.sign="in",s.classList.remove("show"),document.getElementById("username").innerText="Guest",document.getElementById("email").innerText="",document.querySelectorAll(".avatar").forEach(e=>e.src="imgs/no profile.png")}document.addEventListener("click",e=>{e.target.closest("#sign")&&("in"===e.target.closest("#sign").dataset.sign?window.location.href="./authentication.html":s.classList.replace("-bottom-24","bottom-0"))}),s.addEventListener("click",e=>{"BUTTON"===e.target.tagName&&s.classList.replace("bottom-0","-bottom-24"),"yes"===e.target.id&&(a(h),window.location.href="./index.html")})},$=()=>{const t=document.getElementById("account"),s=document.getElementById("verify_user_container"),a=(document.getElementById("account_toggler").addEventListener("click",()=>{if(h.currentUser){const e=document.getElementById("emailNotVerified");h.currentUser.emailVerified||e.classList.replace("hidden","flex"),e.querySelector("button").addEventListener("click",()=>{g(h.currentUser).then(()=>{P("A verification email has been sent to your email address. Please check your inbox and click the verification link to verify your email.","info"),e.classList.replace("flex","hidden")})}),window.scrollTo(0,0),document.body.classList.add("h-screen","overflow-hidden"),t.classList.add("show")}else window.location.href="/authentication.html"}),t.addEventListener("click",e=>{e.target.closest("#close_account")&&(window.location.href.includes("show.html")?document.body.classList.remove("h-screen","overflow-hidden"):document.body.classList.remove("overflow-hidden"),t.classList.remove("show"))}),s.addEventListener("click",function(e){e.target.closest("#close")&&("save"===r.value&&m(),this.classList.remove("show"))}),async t=>{s.querySelector("form").addEventListener("submit",function(e){e.preventDefault(),""===this.email.value?P("Please enter your email","error"):""===this.password.value?P("Please enter your password","error"):(e=b.credential(this.email.value,this.password.value),S(h.currentUser,e).then(()=>{s.classList.remove("show"),this.reset(),t()}).catch(e=>P(I(e.code),"error")))})}),o=(_(),document.getElementById("accountDetails_form")),r=o.action,n=t.querySelector("#change_picture"),i=t.querySelector("[name='Image']"),c=o.querySelectorAll("input"),l=o.querySelector("button"),d=t.querySelector("img"),u=t.querySelector("#cancel"),m=(e=!1)=>{r.value="edit",l.textContent="Edit",c.forEach(e=>{e.setAttribute("readonly","readonly")}),n.classList.replace("grid","hidden"),u.classList.replace("block","hidden"),e||D(h.currentUser)};o.addEventListener("submit",async function(e){e.preventDefault(),"edit"===r.value?(r.value="save",l.textContent="Save Changes",c.forEach(e=>{e.removeAttribute("readonly")}),n.classList.replace("hidden","grid"),u.classList.replace("hidden","block"),i.addEventListener("change",async()=>{var s,e=i.files[0];e.type.startsWith("image/")?d.src=(s=e,await new Promise(t=>{var e=new FileReader;e.addEventListener("load",e=>{t(e.target.result)}),e.readAsDataURL(s)})):d.src="imgs/no profile.png"})):"save"===r.value&&([...document.querySelectorAll("#accountDetails_form input")].some(e=>""==e.value)?P("Please fill in all the fields","error"):(s.querySelector("#action").textContent="updating your information",s.classList.add("show"),a(async()=>{var a,e=d.src.includes("firebasestorage")?d.src:(a=d.src,await new Promise((t,e)=>{var s=h.currentUser;s&&s.uid?(s=L(y(),`usersProfiles/${s.uid}.png`),E(s,a,"data_url").then(e=>{x(e.ref).then(e=>t(e))})):e(new Error("User not logged in or UID not available."))}));f(h.currentUser,{displayName:o.firstName.value+" "+o.lastName.value,photoURL:e}),p(h.currentUser,o.email.value),m(!0),P("Your account details have been updated successfully")})))}),u.addEventListener("click",()=>m());var e=document.getElementById("changePassword_form");C(),e.addEventListener("submit",function(e){e.preventDefault(),""===this.password.value?P("Please enter your new password","error"):""===this.confirmNewPassword.value?P("Please confirm your new password","error"):C()?this.password.value!==this.confirmNewPassword.value?P("Passwords don't match","error"):(s.querySelector("#action").textContent="changing your password",s.classList.add("show"),a(async()=>{v(h.currentUser,this.password.value).then(()=>{P("Your password has been changed successfully","info"),this.reset()}).catch(e=>P(e.message,"error"))})):P("Password is too weak. Please choose a stronger password.","error")}),document.getElementById("reset_password").addEventListener("click",()=>{w(h,h.currentUser.email).then(()=>P("A password reset email has been sent to your email address","info")).catch(e=>P(e.message,"error"))}),document.getElementById("delete_account").addEventListener("click",async()=>{s.querySelector("#action").textContent="deleting your account",s.classList.add("show"),a(async()=>{var e=y();Promise.all([["Favorites","watchList","Episodes"].map(e=>{A(q(k,e,h.currentUser.uid))},B(L(e,`usersProfiles/${h.currentUser.uid}.png`)))]).then(()=>{h.currentUser.delete().then(()=>{P("Your account has been deleted successfully","info"),window.location.href="/"}).catch(e=>P(e.message,"error"))})})})};export{_ as showPassword,C as isValidPassword,P as showMessage,N as checkIfUserIsLoggedIn,O as handleUserAuth,$ as handleAccount,s as toggleList,o as closeList,c as displayShow,l as displayList,d as removeFromList,u as clearList,m as sortList,U as searchList,T as showSearchInput,M as hideSearchInput,F as updateLocalStorageOrDatabase,R as retrieveFromLocalStorageOrDatabase,z as storeInLocalStorageOrDatabase};