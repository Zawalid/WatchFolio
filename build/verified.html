<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Verifying</title>
    <!--* Favicons -->
    <link
      rel="apple-touch-icon"
      sizes="76x76"
      href="imgs/icons/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="imgs/icons/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="imgs/icons/favicon-16x16.png"
    />
    <!--* Main Css  -->
    <link rel="stylesheet" href="./css/style.css" />
    <!--* Google Fonts  -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Bona+Nova:wght@700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.1.0/firebase-auth-compat.js"></script>
  </head>
  <body class="h-screen bg-gradient">
    <div class="container flex h-full flex-col py-5">
      <a href="index.html" class="w-fit">
        <h2 class="font-logo text-4xl font-extrabold max-sm:text-3xl">
          <span class="text-primaryAccent">Watch</span
          ><span class="text-textColor">Folio</span>
        </h2>
      </a>
      <div
        class="flex flex-1 flex-col items-center justify-center gap-5"
        id="verification_message"
      >
        <i
          class="fa-solid fa-spinner animate-spin text-4xl text-thirdAccent"
        ></i>

        <h1 class="text-3xl font-bold text-textColor">Email Verification</h1>
        <p class="text-center font-semibold text-textColor2">
          Please wait while we verify your email address.
        </p>
      </div>
    </div>
    <script type="module">
      import firebase from "./js/firebaseApp.js";
      // Function to handle email verification
      function handleEmailVerification() {
        const urlParams = new URLSearchParams(window.location.search);
        const verificationCode = urlParams.get("oobCode");

        if (verificationCode) {
          firebase
            .auth()
            .applyActionCode(verificationCode)
            .then(() => {
              // Email verification successful
              // You can redirect the user to a success page or show a success message
              document.getElementById("verification_message").innerHTML = `
                <img
                  src="imgs/undraw_done_re_oak4.svg"
                  alt=""
                  class="h-[300px] w-[300px]"
                />

                <h1 class="text-3xl font-bold text-textColor">Email Verified!</h1>
                <p class="text-center font-semibold text-textColor2">
                  Congratulations! Your email address has been successfully verified.
                  You can now fully enjoy all the features and benefits of
                  <span class="font-bold text-primaryAccent">WatchFolio</span>
                </p>
              `;
              document.title = "Verified";
            })
            .catch((error) => {
              document.getElementById("verification_message").innerHTML = `
                <img
                  src="imgs/wrong.svg"
                  alt=""
                  class="h-[300px] w-[300px]"
                />

                <h1 class="text-3xl font-bold text-textColor">Email Verification Failed!</h1>
                <p class="text-center font-semibold text-textColor2">
                  Sorry, we were unable to verify your email address. Please try again
                  later.
                </p>
              `;
            });
          document.title = "Verification Failed";
        } else {
          // Missing verification code, handle error
          console.error("Verification code not found in URL.");
        }
      }

      // Call the function when the page loads
      handleEmailVerification();
    </script>
  </body>
</html>
